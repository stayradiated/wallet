workflows:
  react-native:
    name: postwallet-ios
    max_build_duration: 60

    environment:
      vars:
        APP_STORE_CONNECT_ISSUER_ID: Encrypted(Z0FBQUFBQmdzeHkycDN5Sll1blBrcGZVM2FJSE42RnZpR21HUXkxY1JHMUljM2lsQUs2UFRDWWlpeEp5UnpQRmpFS3BPOU9WY1ZLckNZSVlNNUVrYU5SalRDZWZFUkJMbzFFeGVfeVB0ZFl5M1Y4eDZfTzBENDVXRm1UYkh5X29NVjdCaS1aV21UZWE=)
        APP_STORE_CONNECT_KEY_IDENTIFIER: Encrypted(Z0FBQUFBQmdzeHluTHJndUx6VS0wN00zUXphQ3YtbzFaX2k5cmZGN0NYVTNheWxxMy1hdk9fZmxoXy01T3Y1Mkt3Yi15MmtmRFJOQWxjR3JpNVBNODdRMjBvekF1ZG9tYWc9PQ==)
        APP_STORE_CONNECT_PRIVATE_KEY: Encrypted(Z0FBQUFBQmdzeHpLQ2lObGFGRkIwTTluNzVaZS1qdjlrQWticV90X1hKQU9GM1E3WTNTRkZtNzN1Sm9BTUVzZkQ4OHZBdEN2QkduS0pNdEd0UjBlaDNyV29Rbm5sb0dGY19fZmh0Snh4cFlnVF83b2h1a01OUW5rTC0zVUdmdnVpZTRVWE9XdG5xRzdxM1lYNFFnOWtibWtFa2xRSjZEZEdGX3dLZ1hvQnhiNHRrWkt1NkFMM2t3a3dGSExYX3paQ2hGSmR0azJ1Q0RmQjE1S0M4VExMNmlRM201Y2EwSVM5dW8zakZiMDFacnZrX1V3eGZ5STFiX0pHTWRiZllVNUIweHowNU5naUNmZWhXYVR4bGk1QjlTRVBkcWZiZ21Wc21fMExLZFhNQkUweC1sU1RLTXRfdjVPMV9RalI2bXBadGxQVXhXZkdLWVBoN2VCRTBVOGNURVl3WVBuZ1VJTm5LZ215U3VYNE9idnB4YmF3c05LQXJtNUczNHVBeTFKVWR0dE5PNEZwVUcyVmVPOVNKU2QxRHJHUUo5ek94S3RwSEQ5YWVRS2VrUzJha25YMld5WkRpMVBFSHF3MkpnQkVlX1UySUlEQktvMkxZMVgxSXRlT1JfVkQyYVpVNGZqZm1rT29RWjFhRldDRXh1enBJQjVMNllkQ3RxbWhMbmlXdUk3Y0lDeDRwUV8yTVNES0pBNndWQUg3UXlvcU1rNnBBPT0=)
        CERTIFICATE_PRIVATE_KEY: Encrypted(Z0FBQUFBQmdzeDBsMXhFajREZkZhVFdMeUJCenRNTFl1MzZHVkozMDVoUzZJQVhCYXRhejhzM3lkMkxaUEFtUEhkaDNOU2N4QjYyR0t5LWs1ZVZyNTVXQ2ZtOEgtWVBIamFibkFEMWVxOEk1SEF1MWdDeThzTy1fOVpZX2ZoekZZT25HNldhZGVMYWxheHJVQUktWjhHRjZKM2pvbTNYdEZDTDBWTGh3dnloWWlhRmpnRGF1NURkLXg1WHViOG12ZGFsbFJRa0tBdHhhLVR2OWFpZ0Y2ZnpKc25Vdk9lNW1iX29KdFlROHdwTlJEUHpyWlRMWmtka2NKS1RYUHo5Y2JMS1JiZ2JydVVPbjN0ejJhWWNZem1ZMWRiMGUwUlZqbl9nUlU5V2JidnplS0R5Mm40OXVtMkktMFRmeWhWcFE2bVZUTjQ2V3NnZFlmMVlwelQ3VHZQOTFuWGIzdW5udDItNTFtQ0JqeFR2dDZPTDJBNFRoMmNPdUFDa1VrdzdhVnZiT1JnaThhb2xVZE1EbGhNLUZHVnJKM2lwanVHZF9TTl9PRTk5QU5SZ1VfODJVRk1BWXdzNy1WVDB1WHZJZE5kblQ2aVlyNl9VNmFseEN1Mk5QSEpmak5qN1dDX0F2N045Nm9OclpRUHIxVVZjNHJ1RFJPYU1mRjBVLUo4ZWk3eGM5Y1Z4a1ZTSHZ2YnJ2ZmZPNWtEaVRieHdpZTY4Q2JIUC1hS1JjNXpnMEF4NjM0UTQ1eWdKc0FFMTVLbzlDRVAxMno3UWVOS3RIQzU1cDZlTElobVdRb0NkbnhUNnMyODRZbzd5Y0ZzeUJLb0FyQnNNNXd6aEhBSEJMa1FsRElPRFNJUlF5R3ZseFdtODNzUHh6R29QYWJGZFJabW5nX0I0SnRVTV8xMXpONTJDQmRfU0pNRlV1YkdyXzQwNTdIcTY4ODgtNzAyUElJVldXdVZxelc3ZEFFMTVMTi1VZk5EMXEwVXNEdmJpSDV0Q3ByWS1uaXEzZDB3U0w3eXVVM2lZREJYQnJYM05iVVU3TXhHTTAxLUZsN0JTeUVyVFNodm9pbzdMaTUxN0F3RVRjUHBqVGFGRXA3cEp1RDk5RXhpaXZzeUN3U00zdlMzOXVYNm4xaHJmTFcwSHJONjJrZDNnMXlTeFc1WkNLdlp5YnJaeS1Oc09zeGw1ZXBVanVWekpteHJMNW92Q3dNYnh1QmRBOFh5NEZ2aGhfRGFNclp1dmpSc252cGFtdVhYbVZOeFVQQ0xRWk9nZnU2R2c3YVpFeUN5YnVZRGhnWUhraXRUVUQxV285RWFFVW9LWTlycEdNZm5rYnZmWnlTRDlHcDA2SENnWW1rUk84RElxa0l5RjNFbkhnaWFxdWlrVXVBZUY5TXN6eHQ5UnZtLU90dF9xb29jT3VNckh6cFZuekVfSHhoRFRyUUlYcEpSbWRXX1R6djhOdzF2ZzFfc21oY2Q5ZjRZdmozMHpubjVncEhMbzNWdktiLXNRcXp3SjdiTjV3TXpQdi1wdGo2Q0NLYlNieDdhSjJyS2xKR3NPSUJtYUxQemV1UEphUFljYTNOSVlzdVE2a0hLTmkxMzRmVmV4a0ROV1FHYmkzOHdfc3U5WTdKWjRnRDY1OTI5LWdXOVRaSkRFZ3p4bTVIMDhaOE95ZGdqSXVqSUNQUWFsb29IazNPSklqUmxKVXg4b2lKNktUYi00UHA0bmdTRXlnTGtYWThCZWxrMFdWNHp2TWZKUXdWTDZWSThILVZpMWlyQnNLSmRhZVVRSzJaQ290Rm1oZ0pkb1Exelo0SkxKbFJRX21zblZvd204RnYwR29zWWRiZnFYaGJJanFDUEk5TW5zbENkbHA5eGNkZ3NsY09wWkxDb1Z2dWpLTkxiVVVxUGEtTEpMN0g5U0JfNFlqQWVSZk5nRE1tRFBhUjN0cjJWN29HZlo0eFlxYktiRlpPNkFNZ1pPOXg4TlVHa0ZrUk1LcXQ2M21INEJGOTBGSk9qWWphbkJXdHY1aFVDT1R1QW1SVURZSlBqRjNNMmVyelhWQkh3VmhPT2NoNkhfNjg0WGRFYmlINmVsdXpLMGRrM0pkMUVYV2lrN1dRNjlLRms5UFJfaFFScDhXUGw3TEFtd01OZ3g5YkJCY0Q5TVowYUk4MktRbHhVR2dUdGs2MEtIV3ZRaEo1b2wwcDlZaTFaaHRRcnJaWlgxVjF2Mzh2N3dIWGJrd1JLRzZzRHlwdW9IOXpHbUNRSjl5Q3VjaGk4REpTdjM0enBtVGdLS0RCS1RoQUktcHBPWkNJbHpiSjJpdlRaY2R6YWxaR183RHdiQS1QSVpXa0pjQ3QtRDRSSDVCNE43UzJfUlloUEJUelVlZDZMUi1VTE1DMl85ZUk2dExVQWJLNmNobmF1THVIeGI3TXNRLVp6NVl0QTE0MmtXQmZBbG5pQnl3MkVlS3hjcW9Hb1B6aTdTelFaSVZEWUUyNGU4TFJOWjdNU25pN0FMNHdVSkRneVRIM2I4UnhsdGNLb3VLT1pZalNWcDlPVGliUXBhSW43OVNvdDlnNDdCUm5mQ1Q5RkVEQWRUM2xwQkoxSThxZjNkMkk3YVFSaUloWGczdGxsYWhZNXE4ZlhBNmtiSVEtZ19xemRRVEU3T0pISWx4MnJINkZ0aEJ5Z09DV3pYY2VaaGFHaEFXQ2lxSFZhaWU3dTM1Ti1POWRqTkczX1dkRE5QMkVmZXk0TkhpcEo3U1ZGNG12MTZFVHR2QWVNc2pkUWJSQ29SSlc1YkRmbDhEU3Z5VjE4UEE0Y2N5Y2Rqd1UyNENIZHdrV19OVFI0ME5ZaVM1U250eUdodFA4RkJHeFhIN0NMZzB3TDY3Z3pVMVQ4cjRIXzk3Zzk0cVhnM1BEM0RQVWlDMDEwbHpzcU5jOEFRdmZsWGFhZjVlWWdhb3d6RTQzWFVXZDBEUjlDeF9vdGxsdy1zcUUtbjlJalI3Z2l4d21MeEpRMDRidFJ4Q1A5VTM1TWluQ2I0T0h0RndKdEkwU3JtY3BPUFZPbUlJZ3dtbkxyRDlEZUNnY1BGU0xUSEhDbDF4ZTlEMTRqVzZIazRUd3pPY1oyV183WTdEVUF5UWlnaE9iaXZJRnRuVnIyN0RjVE12SzdQclV6SWxfOC1JcGN1ZUJ1WTVoTXNpcVlvVUVQakVhLTByQS1zRDE2Q1lJVWU0TzVOdkswQ2pRd0ZVTXAtS1BfWDJIODJJNkR0Xzh3M215Y0NhMGJzcGp2RWoyRG8tbE1aeUZURERRbERTak1jNjJPbW9LZFFqUWFzcDVpdXI0ZmZqQ1hMZE40c2Z0cDk5eUZTNDl5c0hRd0hxUFd5LUdHdVozMlhwQmN6TGd3b0Fwd3hkZjZfNXBSMzRzcHN3OGJ2Zms3bHF1U1hhTVZJQjBsRlBEYkRsYzFLMVpBNGdETl80UnJKTGpOVzVnTzU3TS1TaHU0LWdja2FMTndPblpKTjlnTUtZc0UzYldfY2dobWUxcklDcDJZRGF2OGcyWXNzR1ZqTHNiQWM4d05Qak5hUDc4cmhQLWhYV3FxWDVmRXRvbXdfakQwWUQwOWZzVU1jMDlBWmw1bkg2UFk5aFdDTmJaMThrcU5oQjZrTVhQNGs1THVxMWttbG1FMmxWRlZPZHQ3azdJbTZQQ3FCT1lxMG81UnFiS2h2ZVhnR0xfR2hSS1RnSXp6cTZFREpGZEJYSGJQdldUU2szRlZNOHJVaEZFNG5iU3dmeWtCOV9zTU9XeUl6RF9nS3JFTzNUR092SXFsanpWRDZQQzEtTVU1VjNRcWE0Vng3YnVUMmxBVXQ4WE5XeTZFV1l1c3lFSDRQZHl6aDcxNDB1LW15Zk9XWmZOZGluYk5OYWpXdU1Pb3JHVjJ3d2F0cVFWLWpua01hNngtN182NXY3ejBudEVXcXZ4YkJBeFh6dUlrOUItRGppNDBjelhhbHptdl9oZ1I5V0hFbnNrWVRFOGpUZWlYd1N5dVdQRVl6SU5leTRsWHlTeTlibTVBVENWUXFOVXRqVDVqODhJSFFLYkhQa1ZVRlJSdVFyVWppZW5wXzM5MHh2c2g0Z1dpQ1plLTd4Mi12b2ZtX2tPRnlP)
      xcode: latest
      node: latest
      npm: latest

    scripts:
      - name: Set up keychain to be used for code signing using Codemagic CLI 'keychain' command
        script: keychain initialize

      - name: Fetch signing files
        script: |
          # You can allow creating resources if existing are not found with `--create` flag
          app-store-connect fetch-signing-files "$(xcode-project detect-bundle-id)" \
            --type IOS_APP_DEVELOPMENT \
            --create      

      - name: Set up signing certificate
        script: keychain add-certificates

      - name: Set up code signing settings on Xcode project
        script: xcode-project use-profiles

      - name: Install npm dependencies
        script: npm install

      - name: Install CocoaPods dependencies
        script: cd ios && pod install

      - name: Build ipa for distribution
        script: xcode-project build-ipa --project "$FCI_BUILD_DIR/ios/Wallet.xcodeproj" --scheme "Wallet"

    artifacts:
      - build/**/outputs/**/*.aab
      - build/ios/ipa/*.ipa

    publishing:
      # See the following link for details about email publishing - https://docs.codemagic.io/publishing-yaml/distribution/#email
      email:
        recipients:
          - codemagic@stayradiated.com
        notify:
          success: true
          failure: false

